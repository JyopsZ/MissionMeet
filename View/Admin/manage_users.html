<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Users</title>
    <link rel="stylesheet" href="admin_ComponentStyle.css">
</head>
<body>

    <!-- Navigation Bar -->
    <nav class="navbar">
        <a href="#" class="navbar-logo">MissionMeet</a>
        <ul class="navbar-links">
            <li><a href="admin_dashboard.html">Admin Dashboard</a></li>
            <li><a href="profile.html">Organization Profile</a></li>
            <li><a href="manage_users.html">Manage Participants</a></li>
        </ul>
        <div class="navbar-cta">
            <a href="#" class="login-btn" onclick="logout()">Logout</a>
        </div>
    </nav>

    <header>
        <h1>Manage Users</h1>
    </header>

    <div class="admin-container">
        <form id="editUserForm">
            <label for="chooseUser">Choose User:</label>
            <select id="chooseUser" name="chooseUser"></select>

            <h2>Edit User Details</h2> <br>
            <label for="userName">Name:</label>
            <input type="text" id="userName" name="userName" required>

            <label for="userContact">Contact Info:</label>
            <input type="number" id="userContact" name="userContact" required>

            <label for="userEmail">Email:</label>
            <input type="email" id="userEmail" name="userEmail" required>

            <input type="hidden" id="userID" name="userID">

            <button type="submit">Edit User</button>
        </form> <br><br>

        <div class="delete-user">
            <h2>Delete User</h2>
            <label for="deleteUser">Choose User to Delete:</label>
            <select id="deleteUser" name="deleteUser"></select>
            <button type ="button" id="deleteUserBtn">Delete User</button>
        </div> <br><br>

        <!-- Add User to Event Section -->
        <div class="assign-user">
            <h2>Assign User to Event</h2>
            <label for="assignUser">Select User:</label>
            <select id="assignUser" name="assignUser"></select>

            <label for="assignEvent">Select Event:</label>
            <select id="assignEvent" name="assignEvent"></select>

            <button type="button" onclick="assignUserToEvent()">Add User to Event</button>
        </div>
    </div>

    <footer>
        <p>&copy; 2025 Our Website. All rights reserved.</p>
    </footer>

    <script type="module">
      import { getUsers, getEvents, joinEvent, deleteUser } from "../../Controller/DB_CRUD.js";

      document.addEventListener("DOMContentLoaded", async () => {
        const users = await getUsers();
        const events = await getEvents();

        const userDropdowns = ["chooseUser", "deleteUser", "assignUser"];
        userDropdowns.forEach(id => {
          const select = document.getElementById(id);
          users.forEach(user => {
            const opt = document.createElement("option");
            opt.value = user.getUserID();
            opt.textContent = user.getName();
            select.appendChild(opt);
          });
        });

        const eventSelect = document.getElementById("assignEvent");
        events.forEach(event => {
          const opt = document.createElement("option");
          opt.value = event.getEventID();
          opt.textContent = event.getName();
          eventSelect.appendChild(opt);
        });

        const chooseUser = document.getElementById("chooseUser");
        chooseUser.addEventListener("change", () => {
          const user = users.find(u => u.getUserID() === chooseUser.value);
          if (user) {
            document.getElementById("userName").value = user.getName();
            document.getElementById("userEmail").value = user.getEmail();
            document.getElementById("userContact").value = user.getContact(); 
            document.getElementById("userID").value = user.getUserID();
          }
        });

        document.getElementById("editUserForm").addEventListener("submit", async (e) => {
          e.preventDefault();
          alert("Edit logic not yet implemented.");
        });
      });

      window.assignUserToEvent = async () => {
        const userID = document.getElementById("assignUser").value;
        const eventID = document.getElementById("assignEvent").value;
        const result = await joinEvent(userID, eventID);
        alert(result.message);
      };

      document.getElementById("deleteUserBtn").addEventListener("click", async () => {
        const userID = document.getElementById("deleteUser").value;
        
        if (!userID) {
          alert("Please select a user to delete");
          return;
        }
        
        const confirmDelete = confirm("Are you sure you want to delete this user? This action cannot be undone.");
        
        if (confirmDelete) {
          try {
            const result = await deleteUser(userID);
            
            if (result.success) {
              alert(result.message);
              location.reload();
            } else {
              alert(`Failed to delete user: ${result.message}`);
            }
          } catch (error) {
            console.error("Error deleting user:", error);
            alert("An error occurred while deleting the user. Please try again.");
          }
        }
      });
    </script>

    <script>
      function logout() {
        localStorage.clear(); 
        window.location.href = "../../index.html"; 
      }
    </script>
</body>
</html>
